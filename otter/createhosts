#!/usr/bin/perl -w
# create /etc/hosts file's content from data that looks like those below
# __DATA__
use strict;

{

    # read one record at a time
    local $/ = "-=-\n";

    print "#\n# host file - GENERATED BY $0\n# DO NOT EDIT BY HAND!\n#\n";

    while (<DATA>) {
        chomp;    # remove the record separator!
        my %record = split /:\s*|\n/;

        # check for bad hostnames
        if ( $record{name} =~ /[^-.a-zA-Z0-9]/ ) {
            warn "!!! $record{name} contains illegal characters, "
              . "skipping...\n";
            next;
        }

        # check for bad aliases
        if ( $record{aliases} =~ /[^-.a-zA-Z0-9\s]/ ) {
            warn "!!! $record{aliases} contain illegal characters, "
              . "skipping...\n";
            next;
        }

        # check for missing address
        unless ( defined $record{address} ) {
            warn "!!! $record{address} not defined, " . "skipping...\n";
            next;
        }

        print "$record{address}\t$record{name} $record{aliases}\n";
    }

}

__DATA__
name: shimmer
address: 192.168.1.11
aliases: shim shimmy shimmydoodles
owner: David Davis
department: software
building: main
room: 909
manufacturer: Sun
model: M4000
-=-
name: bendir
address: 192.168.1.3
aliases: ben bendoodles
owner: Cindy Coltrane
department: IT
building: west
room: 143
manufacturer: Apple
model: Mac Pro
-=-
